-- Aimlock & Bullet Teleport Script for Roblox (Rivals-Like FPS)
-- Features:
-- - Toggle aimlock with 'Q' (locks onto the nearest enemy with >1 HP)
-- - Switch target with 'Mouse Button 4'
-- - Bullets teleport to the enemy's head, ignoring walls

local UserInputService = game:GetService("UserInputService")
local Players = game:GetService("Players")
local RunService = game:GetService("RunService")
local LocalPlayer = Players.LocalPlayer
local Camera = workspace.CurrentCamera
local Mouse = LocalPlayer:GetMouse()

local AimlockEnabled = false
local TargetEnemy = nil

-- Function to find the nearest enemy with more than 1 HP
local function FindNearestEnemy()
    local closestEnemy = nil
    local shortestDistance = math.huge
    
    for _, player in pairs(Players:GetPlayers()) do
        if player ~= LocalPlayer and player.Character and player.Character:FindFirstChild("Head") then
            local head = player.Character.Head
            local humanoid = player.Character:FindFirstChildOfClass("Humanoid")
            if humanoid and humanoid.Health > 1 then -- Only target players with more than 1 HP
                local screenPos, onScreen = Camera:WorldToViewportPoint(head.Position)
                if onScreen then
                    local distance = (Vector2.new(screenPos.X, screenPos.Y) - Vector2.new(Mouse.X, Mouse.Y)).magnitude
                    if distance < shortestDistance then
                        shortestDistance = distance
                        closestEnemy = player
                    end
                end
            end
        end
    end
    
    return closestEnemy
end

-- Function to lock aim onto target
local function LockAim()
    if TargetEnemy and TargetEnemy.Character then
        local head = TargetEnemy.Character:FindFirstChild("Head")
        if head then
            Camera.CFrame = CFrame.new(Camera.CFrame.Position, head.Position)
        end
    end
end

-- Function to teleport bullets to the enemy's head
local function TeleportBullet()
    if TargetEnemy and TargetEnemy.Character then
        local head = TargetEnemy.Character:FindFirstChild("Head")
        if head then
            local Bullet = Instance.new("Part")
            Bullet.Size = Vector3.new(0.2, 0.2, 0.2)
            Bullet.Color = Color3.fromRGB(255, 0, 0) -- Red to indicate hit
            Bullet.Position = head.Position
            Bullet.Anchored = true
            Bullet.CanCollide = false
            Bullet.Parent = workspace
            
            -- Simulate damage
            local humanoid = TargetEnemy.Character:FindFirstChildOfClass("Humanoid")
            if humanoid then
                humanoid:TakeDamage(100) -- Headshot damage
            end
            
            game.Debris:AddItem(Bullet, 0.5) -- Remove bullet after 0.5 seconds
        end
    end
end

-- Toggle aimlock with 'Q'
UserInputService.InputBegan:Connect(function(input, gameProcessed)
    if gameProcessed then return end
    
    if input.KeyCode == Enum.KeyCode.Q then
        AimlockEnabled = not AimlockEnabled
        if AimlockEnabled then
            TargetEnemy = FindNearestEnemy()
        else
            TargetEnemy = nil
        end
    end
    
    if input.UserInputType == Enum.UserInputType.MouseButton4 then
        TargetEnemy = FindNearestEnemy() -- Switch to the next nearest enemy
    end
end)

-- Lock aim onto enemy every frame if aimlock is enabled
RunService.RenderStepped:Connect(function()
    if AimlockEnabled then
        LockAim()
    end
end)

-- Detect when player fires and teleport the bullet
LocalPlayer:GetMouse().Button1Down:Connect(function()
    TeleportBullet()
end)
